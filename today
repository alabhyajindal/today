#!/usr/bin/env bash

CONFIG_FILE="$HOME/.today.conf"

# Exit if missing configuration
if [ ! -f "$CONFIG_FILE" ]; then
  echo "Missing configuration file."
  exit 1
fi

# Load configuration file
if [ -f "$CONFIG_FILE" ]; then
  # shellcheck source=/dev/null
  source "$CONFIG_FILE"
fi

# Exit if missing directory
if [ ! -d "$DIRECTORY" ]; then
  echo "Missing directory."
  exit 1
fi

# Check if the directory exists
if [ -d "$DIRECTORY" ]; then
  MONTH_PATH="$DIRECTORY/""$MONTH_DIR_NAME"
  FILE_PATH="$DIRECTORY/""$MONTH_DIR_NAME/""$FILE_NAME"

  # Create month directory if missing
  if [ ! -d "$MONTH_PATH" ]; then
    mkdir -p "$MONTH_PATH"
  fi

  # Open note and exit if note exits
  if [ -d "$MONTH_PATH" ]; then
    if [ -f "$FILE_PATH" ]; then
      "${EDITOR:-vim}" "$FILE_PATH"
      exit 0
    fi

    # Create and open note if it doesn't exist
    echo -e "$TEMPLATE" > "$FILE_PATH"
    "${EDITOR:-vim}" "$FILE_PATH"
    exit 0
  fi
fi

