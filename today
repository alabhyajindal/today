#!/bin/sh

CONFIG_FILE="$HOME/.today.conf"

# Exit if missing configuration
if [ ! -f "$CONFIG_FILE" ]; then
  echo "Missing configuration file." >&2
  exit 1
fi

# Load configuration file
if [ -f "$CONFIG_FILE" ]; then
  # shellcheck source=/dev/null
  . "$CONFIG_FILE"
fi

# Exit if missing directory
if [ ! -d "$DIRECTORY" ]; then
  echo "Missing directory." >&2
  exit 1
fi

# Check if the directory exists
if [ -d "$DIRECTORY" ]; then
  MONTH_PATH="$DIRECTORY/$MONTH_DIR_NAME"
  FILE_PATH="$DIRECTORY/$MONTH_DIR_NAME/$FILE_NAME"

  # Create month directory if missing
  mkdir -p "$MONTH_PATH"

  # Open note and exit if note exits
  if [ -d "$MONTH_PATH" ]; then
    if [ -f "$FILE_PATH" ]; then
      exec "${EDITOR:-vim}" "$FILE_PATH"
    fi

    # Create and open note if it doesn't exist
    printf '%s' "$TEMPLATE" > "$FILE_PATH"
    exec "${EDITOR:-vim}" "$FILE_PATH"
  fi
fi

